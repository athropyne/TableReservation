# Бронирование столиков

Сделано ровно то что требовалось в
[задании](https://docs.google.com/document/d/1bgvA0GXB4Fbnr4E7v9uaTh18JMpVXFTxWRIZ4ht7bzM/edit?pli=1&tab=t.0#heading=h.7gulhfaxzbnk)

### Структура:

Код приложения в папке _src/_ .  
В _core/_ -- общие файлы проекта:
интерфейсы,
абстрактные классы,
схемы данных,
настройки инфраструктуры,
файл конфигурации
и т. д.

В папке _services_ модули управления конкретными сущностями (tables, reservations).

###### Содержимое:

* _routes.py_ с описанием конечных точек
* _services.py_ - набор классов обработчиков запроса
* _repositories.py_ - набор классов с операциями над БД
* _events.py_ - перехватчики событий
* _logs.py_ - набор классов, отвечающих за логи операций (только сервисных)
* _exc.py_ - набор пользовательских ошибок
* _dto/_ - набор моделей входных и выходных данных, а так же генерируемых событий

В файле _app.py_ - основная инициализация зависимостей,
подключение роутеров,
инициализация подписчиков.  
Подписчики - функции реагирующие на события (в данном случае только логгеры) публикуемые издателями (в данном случае
только обработчиками запросов - сервисами) Взаимодействие происходит через Redis streams.
***(Разумеется события можно отправлять в другие процессы, приложения и обрабатывать любым способом. 
Данная реализация просто пример, вполне можно только для логов обойтись и без этого).***

Один запрос по API = один запрос в базу. Логика проверки конфликта времени брони на один и тот же стол
проверяется на уровне БД. Все запросы к БД, описания таблиц - исключительно императивные,
никаких скрытых запросов и ORM магии, только обертка SQLAlchemy core.

### Запуск

Отредактируйте файл _.env_ под собственные нужды если необходимо (стандартные настройки в корне проекта).  
Выполните команду ```docker compose up``` из корня проекта.

После успешного запуска (приглашение в консоли вроде такого ```INFO   Uvicorn running on http://localhost:9000```)  
перейдите по адресу http://localhost:9000/docs (или теми настройками которые вы указали в _.env_)
для просмотра OpenAPI документации.

### P.S. странное поведение

После поднятия контейнеров и открытия OpenAPI
первый запрос в базу выдаст ошибку подключения. Почему?
Понятия не имею! Без контейнеров на стационарной базе и колдовства с alembic такого поведения нет. Последующие запросы
идут как положено.


